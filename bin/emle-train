#!/usr/bin/env python

import argparse
import numpy as np

parser = argparse.ArgumentParser(
    description="EMLE training script"
)

parser.add_argument("--orca-tarball", type=str,
                    metavar='name.tar',
                    required=True,
                    help="ORCA tarball")
parser.add_argument("--train-mask", type=str,
                    metavar='mask.dat',
                    help="Mask for training set")
parser.add_argument("output", type=str,
                    help="Output model file")
args = parser.parse_args()


import scipy.io

from emle._orca_parser import ORCAParser
from emle.train import EMLETrainer

parser = ORCAParser(args.orca_tarball, decompose=False, alpha=True)

train_mask = None
if args.train_mask:
    train_mask = np.loadtxt(args.train_mask, dtype=bool)

trainer = EMLETrainer()
trainer.train(z=parser.z,
              xyz=parser.xyz,
              s=parser.mbis['s'],
              q_core=parser.mbis['q_core'],
              q=parser.mbis['q_core'] + parser.mbis['q_val'],
              alpha=parser.alpha,
              train_mask=train_mask,
              model_filename=args.output)
